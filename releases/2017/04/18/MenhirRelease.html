<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Using Menhir to Build Grammar Attributes</title>
  <meta name="description" content="Menhir is a parser generator for OCaml that compiles LR(1) grammar specifications to OCaml code. It is developed by François Pottier and Yann Régis-Gianas.">
  <!-- todo: include this into main.css -->
  <link rel="stylesheet" href="/css/font-awesome.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://ocamllabs.github.io//releases/2017/04/18/MenhirRelease.html">
  <link rel="alternate" type="application/rss+xml" title="OCaml Labs" href="https://ocamllabs.github.io//feed.xml">
</head>

  <body>
    <div class="page-content">
      <div class="container">
        <div class="three columns">
          <header class="site-header">

  <h2 class="logo">
   <a href="/">OCaml Labs</a><br />
   
   <img width="100px" src="/assets/img/origami-camel.png" />
   
  </h2>

  <div class="nav">
    
    <label for="menu-toggle" class="menu-icon">
        <!--div data-icon="ei-navicon"></div-->
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
    </label>
    <input type="checkbox" id="menu-toggle">

    <div class="site-nav">
      <nav>
        <ul class="page-link">
          <li><a href="/">Home</a></li>
          <li><a href="/news">News</a></li>
          <li><a href="/doc">Projects</a></li>
          <li><a href="/community">Community</a></li>
          <li><a href="/people">People</a></li>
          <li><a href="/papers">Papers</a></li>
          <li><a href="/talks">Talks</a></li>
          <li><a href="/about">About</a></li>
          <li><a href="/feed.xml">RSS</a></li>
        </ul>
      </nav>
    </div>

  </div>
</header>

        </div>

        <div class="nine columns" style="z-index:100;">
          <div class="wrapper">
            <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="article_header">
    <h1 class="article_title" itemprop="name headline">Using Menhir to Build Grammar Attributes</h1>
    <p class="article_meta"><time datetime="2017-04-18T00:00:00+00:00" itemprop="datePublished">Apr 18, 2017</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">let-def</span></span></p>
  </header>

  <div class="article-content" itemprop="articleBody">
    <p><a href="http://gallium.inria.fr/~fpottier/menhir/">Menhir</a> is a parser generator for OCaml that compiles LR(1) grammar specifications to OCaml code. It is developed by François Pottier and Yann Régis-Gianas.</p>

<p>The new release out this week includes:</p>

<ul>
  <li>License changed from QPL to GPLv2</li>
  <li><a href="https://gitlab.inria.fr/users/sign_in">Public repository</a> on GitLab</li>
  <li>API improvements</li>
  <li>MenhirSdk library</li>
</ul>

<p>View the details:</p>

<ul>
  <li><a href="https://sympa.inria.fr/sympa/arc/caml-list/2017-04/msg00075.html">Main announcement</a></li>
  <li><a href="https://gitlab.inria.fr/fpottier/menhir/blob/master/CHANGES.md">Full list of changes</a></li>
  <li><a href="http://gallium.inria.fr/~fpottier/menhir/manual.pdf">Documentation manual</a></li>
  <li><a href="https://opam.ocaml.org/packages/menhir/">Download</a> the release from opam</li>
</ul>

<h3 id="menhirsdk">MenhirSdk</h3>

<p>This new library has been added to allow external tools (such as <a href="https://github.com/ocaml/merlin">Merlin</a>) to interact with Menhir by offering a programmatic interface to consume Menhir datastructures (grammar and automaton, on which specific user attributes can be added).</p>

<p>Originally, Merlin used its own version of Menhir. It added a few fancy things such as recovering from any situation (to always produce an AST), introspecting the state (to understand errors), etc. The changes were quite specific and intrusive, so the next job was to develop a generic infrastructure on top of which these features can be implemented.</p>

<p>The first part was the <strong>incremental</strong> interface, merged two years ago, which exposed parser checkpoints and give the control of the parsing loop to the user. It also provided a limited <strong>introspection</strong> API to make sense of the current state of the parser (for printing purposes). A hard-coded printer implementation was also offered to Menhir users, but it didn’t offer much flexibility for customizing the printing.</p>

<p>The next part was to extend the inspection interface and to expose information about the grammar and the automaton. At compile-time, <strong>MenhirSdk</strong> allows to extract information from the grammar and the automaton. At run-time, the extended <strong>MenhirLib</strong> API allows to manipulate the state of the parser in a type safe way.</p>

<p><strong>Using MenhirSdk with external tools</strong></p>

<p>The main benefit is that Menhir focuses on the grammar and generates an automaton without being affected by user extensions. Various constructions of the grammar can be given attributes, inspired by PPXs, that Menhir will pass unchanged to the Sdk. The Sdk is just an OCaml library that exposes the grammar, the automaton (and the mapping between both) together with the user attributes.</p>

<p>Some examples demonstrating these possibilities should come later, mostly inspired by the use of MenhirSdk in Merlin.</p>

<p>Extensions being considered:</p>

<ul>
  <li><code class="highlighter-rouge">gen_recover</code>: generates an error resilient parser: at any point in parse you can get an AST, obtained by filling holes in the tree with default values (either manually provided or automatically derived from grammar), or reattach to a later point in the token stream</li>
  <li><code class="highlighter-rouge">gen_printer</code>: introspects the content of a parser, displays information about its runtime state and the corresponding grammar part</li>
  <li><code class="highlighter-rouge">gen_explain</code>: quick’n’dirty explanation of parse errors</li>
  <li>coverage test: generate sentences that will exercise the grammar</li>
  <li>BNF grammar: generates BNF from a Menhir Grammar (following RFC or TeX conventions)</li>
</ul>

<p>Related reading:</p>

<ul>
  <li><a href="https://news.ycombinator.com/item?id=13915150">Incremental parsing conversation on Hacker News</a></li>
</ul>

<hr />

  </div>

  <div class="article-related">Related Posts</div>
  <ul>
   
     <li><a href="/general/2017/12/14/DerivingCrowbar.html">testing ocaml-migrate-parsetree with `ppx_deriving_crowbar`</a></li>
   
     <li><a href="/general/2017/10/30/WindowsUnicode.html">Windows Unicode Support - A Bug-Fix 12 Years in the Making</a></li>
   
     <li><a href="/general/2017/10/24/Bun.html">Fuzzing for CI Workflows</a></li>
   
     <li><a href="/general/2017/09/27/GithubCI.html">Testing Your Own Fork With OCaml's GitHub CI</a></li>
   
     <li><a href="/general/2017/09/04/OcalPlatformPackaging.html">Platforms, Packaging, Progress</a></li>
   
     <li><a href="/general/2017/08/25/Merlin3WindowsSupport.html">Merlin 3.0.0 on Windows</a></li>
   
     <li><a href="/rfc/2017/07/27/NewGitRFC.html">A New Implementation of Git</a></li>
   
     <li><a href="/releases/2017/07/19/MirageOSLibraryReleases.html">Major Releases of Cohttp, Conduit, DNS and TCP/IP Libraries</a></li>
   
     <li><a href="/releases/2017/07/13/ocaml4.05.html">OCaml 4.05.0 Released</a></li>
   
     <li><a href="/general/2017/06/26/IntelHyperThreadBug.html">Intel Hyper-Threading Bug Uncovered by OCaml Developers</a></li>
   
  </ul>

  <footer class="article-footer">

  <section class="share">
  <a class="share-link" href="" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
    Twitter
  </a>
  <a class="share-link" href="" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
    Facebook
  </a>
  <a class="share-link" href="" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530'); return false;">
    Google+
  </a> 
</section>


  <hr/>

  
<section class="author">
  <div class="authorimage box" style="background: url(/assets/img/let-def.png)"></div>
  <div class="authorinfo box">
    <p>Author | <a href="">Frédéric Bour</a></p>
    <p class="bio"><p>Fred develops <a href="https://github.com/ocaml/merlin">Merlin</a> and a few other OCaml tools with OCaml Labs</p>
</p>
  </div>
</section>


  </footer>

</article>

          </div>
        </div>
      </div>
      <footer class="site-footer">
  <div class="container">
    <div class="footer left column one-half">
      <section class="small-font">
        Content © 2012-2017 under a <a href="https://wiki.creativecommons.org/wiki/CC0">CC0</a> license.<br />
        Theme based on <a href="https://github.com/wild-flame/jekyll-simple">Jekyll-Simple</a> by <a href="http://wildflame.me">wildflame</a>.
      </section>
    </div>

    <div class="footer right column one-half">
      <section class="small-font">
        
        <a href="https://github.com/ocamllabs"><i class="fa fa-github fa-2x"></i></a>
        
        
        <a href="https://twitter.com/ocamllabs"><i class="fa fa-twitter fa-2x"></i></a>
        
      </section>
    </div>
  </div>
</footer>
 
    </div>
  </body>
</html>
