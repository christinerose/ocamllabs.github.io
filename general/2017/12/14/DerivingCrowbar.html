<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>testing ocaml-migrate-parsetree with `ppx_deriving_crowbar`</title>
  <meta name="description" content="testing ocaml-migrate-parsetree with ppx_deriving_crowbar">
  <!-- todo: include this into main.css -->
  <link rel="stylesheet" href="/css/font-awesome.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://ocamllabs.github.io//general/2017/12/14/DerivingCrowbar.html">
  <link rel="alternate" type="application/rss+xml" title="OCaml Labs" href="https://ocamllabs.github.io//feed.xml">
</head>

  <body>
    <div class="page-content">
      <div class="container">
        <div class="three columns">
          <header class="site-header">

  <h2 class="logo">
   <a href="/">OCaml Labs</a><br />
   
   <img width="100px" src="/assets/img/origami-camel.png" />
   
  </h2>

  <div class="nav">
    
    <label for="menu-toggle" class="menu-icon">
        <!--div data-icon="ei-navicon"></div-->
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
    </label>
    <input type="checkbox" id="menu-toggle">

    <div class="site-nav">
      <nav>
        <ul class="page-link">
          <li><a href="/">Home</a></li>
          <li><a href="/news">News</a></li>
          <li><a href="/doc">Projects</a></li>
          <li><a href="/community">Community</a></li>
          <li><a href="/people">People</a></li>
          <li><a href="/papers">Papers</a></li>
          <li><a href="/talks">Talks</a></li>
          <li><a href="/about">About</a></li>
          <li><a href="/feed.xml">RSS</a></li>
        </ul>
      </nav>
    </div>

  </div>
</header>

        </div>

        <div class="nine columns" style="z-index:100;">
          <div class="wrapper">
            <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="article_header">
    <h1 class="article_title" itemprop="name headline">testing ocaml-migrate-parsetree with `ppx_deriving_crowbar`</h1>
    <p class="article_meta"><time datetime="2017-12-14T00:00:00+00:00" itemprop="datePublished">Dec 14, 2017</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">yomimono</span></span></p>
  </header>

  <div class="article-content" itemprop="articleBody">
    <h1 id="testing-ocaml-migrate-parsetree-with-ppx_deriving_crowbar">testing ocaml-migrate-parsetree with <code class="highlighter-rouge">ppx_deriving_crowbar</code></h1>

<p><a href="https://github.com/stedolan/crowbar/issues/7">Early feedback</a> on Crowbar suggested that some automated method of constructing generators might be useful.  It wasn’t necessary to do this immediately for <a href="https://github.com/yomimono/ocaml-test-stdlib">the demonstration of testing the OCaml standard library’s Map and Set functors</a> with Crowbar, but what about more complicated types?  Like, say, the complicated and heavily mutually recursive types that compose <a href="https://github.com/ocaml/ocaml/blob/trunk/parsing/parsetree.mli">OCaml parsetrees</a>?</p>

<p>With an eye to solving this problem, I looked into a few options and finally settled on using <a href="https://github.com/ocaml-ppx/ppx_deriving">ppx_deriving</a>.  <code class="highlighter-rouge">ppx_deriving</code> is “a library simplifying type-driven code generation”, and not just for the author of an automatic code-generating tool, but also for the user who might wish to use such tools, or the maintainer who wants to be sure that multiple tools can be used together easily.  Using <code class="highlighter-rouge">ppx_deriving</code>, one can annotate a type <code class="highlighter-rouge">t</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>type t = {
  a : int;
  b : Parsetree.core_type;
} [@@deriving myplugin]
</code></pre></div></div>

<p>and <code class="highlighter-rouge">myplugin</code> will have a chance to generate code based on the structure of <code class="highlighter-rouge">t</code>.</p>

<p>I was able to create such a tool for Crowbar, creatively named <a href="https://github.com/yomimono/ppx_deriving_crowbar">ppx_deriving_crowbar</a>.  The plugin is still in an experimental state, but mostly fulfills the requirements for <code class="highlighter-rouge">ppx_deriving</code> plugins set out in that project’s README.  It is capable of making generators for <a href="https://github.com/yomimono/ocaml-test-omp/blob/primary/test/parsetree_405.ml">OCaml 4.05 parsetrees</a> and certificates for the <a href="https://github.com/mirleft/ocaml-x509">x509 library</a>, and probably much more!</p>

  </div>

  <div class="article-related">Related Posts</div>
  <ul>
   
     <li><a href="/general/2017/10/30/WindowsUnicode.html">Windows Unicode Support - A Bug-Fix 12 Years in the Making</a></li>
   
     <li><a href="/general/2017/10/24/Bun.html">Fuzzing for CI Workflows</a></li>
   
     <li><a href="/general/2017/09/27/GithubCI.html">Testing Your Own Fork With OCaml's GitHub CI</a></li>
   
     <li><a href="/general/2017/09/04/OcalPlatformPackaging.html">Platforms, Packaging, Progress</a></li>
   
     <li><a href="/general/2017/08/25/Merlin3WindowsSupport.html">Merlin 3.0.0 on Windows</a></li>
   
     <li><a href="/rfc/2017/07/27/NewGitRFC.html">A New Implementation of Git</a></li>
   
     <li><a href="/releases/2017/07/19/MirageOSLibraryReleases.html">Major Releases of Cohttp, Conduit, DNS and TCP/IP Libraries</a></li>
   
     <li><a href="/releases/2017/07/13/ocaml4.05.html">OCaml 4.05.0 Released</a></li>
   
     <li><a href="/general/2017/06/26/IntelHyperThreadBug.html">Intel Hyper-Threading Bug Uncovered by OCaml Developers</a></li>
   
     <li><a href="/rfc/2017/06/15/UnsignedIntegers.html">Unsigned Integers as Built-In Types or as a Library?</a></li>
   
  </ul>

  <footer class="article-footer">

  <section class="share">
  <a class="share-link" href="" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
    Twitter
  </a>
  <a class="share-link" href="" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
    Facebook
  </a>
  <a class="share-link" href="" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530'); return false;">
    Google+
  </a> 
</section>


  <hr/>

  
<section class="author">
  <div class="authorimage box" style="background: url(/assets/img/yomimono.png)"></div>
  <div class="authorinfo box">
    <p>Author | <a href="https://somerandomidiot.com/">Mindy Preston</a></p>
    <p class="bio"><p>Mindy was a founding member of the <a href="http://unikernel.com/">Unikernel Systems</a> team and is now the principal member of Identity Function, LLC. She is a core <a href="https://mirage.io/">MirageOS</a> team member and managed the release of MirageOS 3.0.  She is a proud <a href="https://outreachy.gnome.org/?q=program_home&amp;prg=7">Outreachy</a> alum and mentor.</p>
</p>
  </div>
</section>


  </footer>

</article>

          </div>
        </div>
      </div>
      <footer class="site-footer">
  <div class="container">
    <div class="footer left column one-half">
      <section class="small-font">
        Content © 2012-2017 under a <a href="https://wiki.creativecommons.org/wiki/CC0">CC0</a> license.<br />
        Theme based on <a href="https://github.com/wild-flame/jekyll-simple">Jekyll-Simple</a> by <a href="http://wildflame.me">wildflame</a>.
      </section>
    </div>

    <div class="footer right column one-half">
      <section class="small-font">
        
        <a href="https://github.com/ocamllabs"><i class="fa fa-github fa-2x"></i></a>
        
        
        <a href="https://twitter.com/ocamllabs"><i class="fa fa-twitter fa-2x"></i></a>
        
      </section>
    </div>
  </div>
</footer>
 
    </div>
  </body>
</html>
