<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Scaling Software Modularization with Topkg</title>
  <meta name="description" content="There is one issue that bazaars, library operating systemslike MirageOS or random left-padists face: how to scale extremesoftware modularization. Scaling not...">
  <!-- todo: include this into main.css -->
  <link rel="stylesheet" href="/css/font-awesome.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://ocamllabs.github.io//projects/2017/02/23/topkg.html">
  <link rel="alternate" type="application/rss+xml" title="OCaml Labs" href="https://ocamllabs.github.io//feed.xml">
</head>

  <body>
    <div class="page-content">
      <div class="container">
        <div class="three columns">
          <header class="site-header">

  <h2 class="logo">
   <a href="/">OCaml Labs</a><br />
   
   <img width="100px" src="/assets/img/origami-camel.png" />
   
  </h2>

  <div class="nav">
    
    <label for="menu-toggle" class="menu-icon">
        <!--div data-icon="ei-navicon"></div-->
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
    </label>
    <input type="checkbox" id="menu-toggle">

    <div class="site-nav">
      <nav>
        <ul class="page-link">
          <li><a href="/">Home</a></li>
          <li><a href="/news">News</a></li>
          <li><a href="/doc">Projects</a></li>
          <li><a href="/community">Community</a></li>
          <li><a href="/people">People</a></li>
          <li><a href="/papers">Papers</a></li>
          <li><a href="/talks">Talks</a></li>
          <li><a href="/about">About</a></li>
          <li><a href="/feed.xml">RSS</a></li>
        </ul>
      </nav>
    </div>

  </div>
</header>

        </div>

        <div class="nine columns" style="z-index:100;">
          <div class="wrapper">
            <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="article_header">
    <h1 class="article_title" itemprop="name headline">Scaling Software Modularization with Topkg</h1>
    <p class="article_meta"><time datetime="2017-02-23T00:00:00+00:00" itemprop="datePublished">Feb 23, 2017</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">dbuenzli</span></span></p>
  </header>

  <div class="article-content" itemprop="articleBody">
    <p>There is one issue that bazaars, library operating systems
like MirageOS or random left-padists face: how to scale extreme
software modularization. Scaling not from a software composition perspective;
this could be readily solved by using the type system and the
functional programming techniques everyone’s heard about. But scaling from a
purely bureaucratic point of view.</p>

<p>The bureaucracy of making sure main issues are being taken care of. The
bureaucracy of making sure changes to the software are being clearly
communicated to dependents. The bureaucracy of making sure the software
is correctly versioned and is able to precisely self-describe as such. The
bureaucracy of making sure the software is a good citizen of the
eco-system and that it follows its evolution. The bureaucracy of being
able to quickly push fixes and let dependents test them as if they
were released. The bureaucracy of making flawless releases: publishing
correct and reproducible tarballs, publishing documentation and submitting
the software package to the OCaml opam repository.</p>

<p>All this has clearly nothing to do with the fun of programming and
calls for efficient, standardized, “don’t make me think” procedures and
conventions. To give some perspective I myself formally publish 28 software
packages, the MirageOS project directly manages 93 packages, any two minutes
administrative task on each of these respectively represent one and three
hours gone – dreadful hours. Any non-project specific bit that has to be
committed to these repositories is maintenance burden and a curse.</p>

<p>This is where <a href="http://erratique.ch/software/topkg">topkg</a> fits in.
If you want to learn more about it, make sure to read the <a href="http://erratique.ch/software/topkg/doc/Topkg.html#basics">documentation
basics</a> and
the tool manual (<code class="highlighter-rouge">opam install topkg-care &amp;&amp; topkg help</code>). To sum up,
you give <code class="highlighter-rouge">topkg</code> enough information so that it is able to determine what
needs to be installed in the current build environment. From these bits
<code class="highlighter-rouge">topkg</code> will infer targets to <em>invoke</em> in your build system – rather than
try to <em>generate</em> one – and produce a manifest file to let the package
manager install your package.</p>

<p>A few additional conventions and metadata bits you specify allow to
lint the package for good practices and release your software with the
<code class="highlighter-rouge">topkg</code> tool according to a well defined script. Read all the details
in <code class="highlighter-rouge">topkg help release</code> but the gist of it is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>topkg browse issues # Review remaining outstanding issues
topkg status        # Review the changes since last version
topkg log edit      # Write the release notes
topkg log commit    # Commit the release notes
topkg tag           # Tag the distribution with a version
topkg distrib       # Create the distribution archive
topkg publish       # Publish it on the WWW with its documentation
topkg opam pkg      # Create an opam package
topkg opam submit   # Submit it to OCaml's opam repository

The last four steps can be performed via a single invocation to
topkg bistro.
</code></pre></div></div>

<p><code class="highlighter-rouge">topkg</code> is far from being a perfect system, it tries to compose with
the existing build infrastructure. It is a step towards what is needed
from a packaging workflow perspective to scale modularity: the act of
releasing should be an inane, swift, robust and painless process.</p>

<p>If you are interested in <em>programming</em> and sharing your results, give
<a href="http://erratique.ch/software/topkg">topkg</a> a try. No left-pad function
left behind.</p>

  </div>

  <div class="article-related">Related Posts</div>
  <ul>
   
     <li><a href="/general/2017/12/14/DerivingCrowbar.html">testing ocaml-migrate-parsetree with `ppx_deriving_crowbar`</a></li>
   
     <li><a href="/general/2017/10/30/WindowsUnicode.html">Windows Unicode Support - A Bug-Fix 12 Years in the Making</a></li>
   
     <li><a href="/general/2017/10/24/Bun.html">Fuzzing for CI Workflows</a></li>
   
     <li><a href="/general/2017/09/27/GithubCI.html">Testing Your Own Fork With OCaml's GitHub CI</a></li>
   
     <li><a href="/general/2017/09/04/OcalPlatformPackaging.html">Platforms, Packaging, Progress</a></li>
   
     <li><a href="/general/2017/08/25/Merlin3WindowsSupport.html">Merlin 3.0.0 on Windows</a></li>
   
     <li><a href="/rfc/2017/07/27/NewGitRFC.html">A New Implementation of Git</a></li>
   
     <li><a href="/releases/2017/07/19/MirageOSLibraryReleases.html">Major Releases of Cohttp, Conduit, DNS and TCP/IP Libraries</a></li>
   
     <li><a href="/releases/2017/07/13/ocaml4.05.html">OCaml 4.05.0 Released</a></li>
   
     <li><a href="/general/2017/06/26/IntelHyperThreadBug.html">Intel Hyper-Threading Bug Uncovered by OCaml Developers</a></li>
   
  </ul>

  <footer class="article-footer">

  <section class="share">
  <a class="share-link" href="" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
    Twitter
  </a>
  <a class="share-link" href="" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
    Facebook
  </a>
  <a class="share-link" href="" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530'); return false;">
    Google+
  </a> 
</section>


  <hr/>

  
<section class="author">
  <div class="authorimage box" style="background: url(/assets/img/dbuenzli.png)"></div>
  <div class="authorinfo box">
    <p>Author | <a href="http://erratique.ch/contact.en">Daniel Bünzli</a></p>
    <p class="bio"><p>Daniel develops a <a href="http://erratique.ch/tags/OCaml">number of core open source OCaml libraries and features</a> with OCaml Labs.</p>
</p>
  </div>
</section>


  </footer>

</article>

          </div>
        </div>
      </div>
      <footer class="site-footer">
  <div class="container">
    <div class="footer left column one-half">
      <section class="small-font">
        Content © 2012-2017 under a <a href="https://wiki.creativecommons.org/wiki/CC0">CC0</a> license.<br />
        Theme based on <a href="https://github.com/wild-flame/jekyll-simple">Jekyll-Simple</a> by <a href="http://wildflame.me">wildflame</a>.
      </section>
    </div>

    <div class="footer right column one-half">
      <section class="small-font">
        
        <a href="https://github.com/ocamllabs"><i class="fa fa-github fa-2x"></i></a>
        
        
        <a href="https://twitter.com/ocamllabs"><i class="fa fa-twitter fa-2x"></i></a>
        
      </section>
    </div>
  </div>
</footer>
 
    </div>
  </body>
</html>
